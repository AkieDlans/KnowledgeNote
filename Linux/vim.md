# 01. vi 简介

需要在 ssh 中对文件进行简单的修改，由于 ssh 中没有图形界面，所以需要使用 vi 进行快速编辑

## 01.1 vi 和 vim

- 在很多 Linux 发行版中，直接把 vi 做成 vim 的软链接

**vi**

- vi 是 Visual interface，是 Linux 中最经典的文编编辑器
- vi 的核心设计思想：让程序员的手指始终保持在键盘的核心区域，就能完成所有的编辑操作

- vi 的特点

  - 没有图形界面

  - 只能编辑文本内容，不能进行字体、段落的排版

  - 不支持鼠标操作

  - 没有菜单

  - 只有命令

- vi 在系统管理、服务器管理编辑文件时，其功能不是图形界面的编辑器能比拟的

**vim**

- vim = vi improved
- vim 是从 vi 中发展出来的一个文本编辑器，支持代码补全、编译、错误跳转等方便编程的功能

# 02. 打开和新建文件

- 在终端中输入 vi 在后面跟上文件名即可
- 如果文件存在，会直接打开一个文件
- 如果文件不存在，会新建一个文件

## 02.1 打开文件并且定位行

`vi 文件名 +行数` 

- 如果只带 `+` 而不带行号，则会跳到文件末尾

## 02.2 异常处理

- 如果 vi 异常退出，在磁盘上可能会保存有交换文件
- 下次再使用 vi 编辑该文件时，会在终端底部提示，按下 d 删除交换文件即可

## 02.3 三种工作模式

**命令模式**

- 打开文件首先进入命令模式，是使用 vi 的入口
- 通过命令对文件进行常规的编辑操作，例如：定位、翻页、复制、粘贴、删除
- 按 `i` 进入编辑模式，`:` 进入末行模式
- `set ts=4` ：修改 Tab 的宽度
- `set nu` ：显示行号

**末行模式**

- 执行保存、退出等操作

- 末行模式是 vi 的出口

- 按 `esc` 进入命令模式，按 `wq` 关闭文件

  末行模式命令

  | 命令 | 说明                           |
  | ---- | ------------------------------ |
  | w    | 保存                           |
  | q    | 退出，如果没有保存，不允许退出 |
  | q!   | 强行退出，不保存               |
  | wq   | 保存退出                       |
  | x    | 保存退出                       |

  

**编辑模式**

- 正常的编辑文字
- 按 `esc` 回到命令模式

## 02.4 常用命令

- 重复次数：在命令模式下，先输入一个数字，再跟上一个命令，可以让该命令重复执行指定次数
- 移动和选择
- 编辑操作
- 撤销和重复
- 查找替换
- 编辑

## 02.5 行数移动

| 命令   | 功能                           |
| ------ | ------------------------------ |
| gg     | 文件顶部                       |
| G      | 文件末尾                       |
| 数字gg | 移动到数字对应行数             |
| 数字G  | 移动到数字对应行数             |
| :数字  | 移动到数字对应行数（末行模式） |

## 02.6 屏幕移动

| 命令   | 功能     |
| ------ | -------- |
| Ctrl+b | 向上翻页 |
| Ctrl+f | 向下翻页 |
| H      | 屏幕顶部 |
| M      | 屏幕中间 |
| L      | 屏幕底部 |

## 02.7 段落移动和括号切换

段落移动

- vi 使用空行老区分段落
- 一段功能相关的代码会写在一起，之间没有空行

| 命令 | 功能   |
| ---- | ------ |
| {    | 上一段 |
| }    | 下一段 |

括号切换

| 命令 | 功能           |
| ---- | -------------- |
| %    | 括号匹配及切换 |

# 03. 命令模式

1. 添加空白行：`o` 在当前行的下面插入新行，`O` 在当前行的上面插入新行。插入后会进入编辑模式
1. 移动光标的方法

| 操作            | 含义                                         |
| --------------- | -------------------------------------------- |
| h 或左方向键    | 左移一个字符                                 |
| j 或下方向键    | 下移一个字符                                 |
| k 或上方向键    | 上移一个字符                                 |
| l 或右方向键    | 右移一个字符                                 |
| ctrl + f        | 向下移动一页，相当于 Page Down               |
| ctrl + b        | 向上移动一页，相当于 Page Up                 |
| +               | 光标移动到非空白字符的下一列                 |
| -               | 光标移动到非空白字符的上一列                 |
| number`<space>` | 光标向右移动这一列的 number 个字符           |
| 0 或 Home       | 移动到这一列的最前面字符                     |
| $ 或 End        | 移动到这一列的最后面字符                     |
| H               | 光标移动到当前屏幕的最上方那一列的第一个字符 |
| M               | 光标移动到当前屏幕的中央那一列的第一个字符   |
| L               | 光标移动到当前屏幕的最下方那一列的第一个字符 |
| G               | 移动到这个文件的最后一列                     |
| nmberG          | 移动到这个文件的 number 列                   |
| gg              | 移动到这个文件的第一列                       |
| number`<Enter>` | 光标向下移动 number 列                       |
|                 |                                              |

3. 搜索

| 操作  | 含义                           |
| ----- | ------------------------------ |
| /word | 在光标位置之下寻找 word 字符串 |
| ?word | 在光标位置之上寻找 word 字符串 |
| n     | 重复前一个搜索动作             |
| N     | 反向进行前一个搜索动作         |

4. 删除、复制、粘贴

| 操作     | 含义                               |
| -------- | ---------------------------------- |
| x        | 删除后一个字符                     |
| X        | 删除前一个字符                     |
| numberx  | 向后删除 number 个字符             |
| dd       | 删除光标所在行                     |
| numberdd | 删除光标所在的后 number 行         |
| d1G      | 删除光标所在行之前的所有数据       |
| dG       | 删除光标所在行之后的所有数据       |
| d$       | 删除光标所在处到该行的最后一个字符 |
| d0       | 删除光标所在处到该行的最前一个字符 |
| yy       | 复制光标所在行                     |
| numberyy | 复制光标所在的向下 number 行       |
| y1G      | 复制光标所在到第一行的所有数据     |
| yG       | 复制光标所在到最后一行的所有数据   |
| y0       | 复制光标所在到该行行首的所有字符   |
| y$       | 复制光标所在到该行行尾的所有字符   |
| p        | 将复制的内容粘贴到光标的下一列     |
| P        | 将复制的内容粘贴到光标的上一列     |
| u        | 撤销                               |
| ctrl + r | 重复上一个操作                     |
| .        | 重复上一个操作                     |

5. 进入插入模式

| 操作 | 含义                                     |
| ---- | ---------------------------------------- |
| i    | 光标前插入                               |
| I    | 光标后插入                               |
| a    | 光标所在的下一个字符处插入               |
| A    | 光标所在行的最后一个字符处插入           |
| r    | 取代模式，仅取代光标所在位置一次         |
| R    | 一直取代光标所在位置的文字，知道按下 Esc |

6. 区块复制

| 操作               | 含义                           |
| ------------------ | ------------------------------ |
| v 或 V 或 ctrl + v | 区块选择，光标经过的地方会反白 |
| y                  | 将反白的地方复制               |
| d                  | 将反白的地方删除               |
| p                  | 将复制的区块，在光标位置粘贴   |





# 04. 编辑模式



# 05. 末行模式

1. 替换

| 操作                            | 含义                                                |
| ------------------------------- | --------------------------------------------------- |
| :number1,number2s/word1/word2/g | 在 number1 行和 number2 行之间将 word1 替换为 word2 |
| :1,$s/word1/word2/g             | 将所有 word1 替换为 word2                           |
| :1,$s/word1/word2/gc            | 替换时有确认步骤                                    |

2. 其它指令

| 操作        | 含义                             |
| ----------- | -------------------------------- |
| :! command  | 执行 shell 指令                  |
| :w filename | 将编辑的数据存储成另一个文件     |
| :r filename | 将 filename 中的内容加到文件末尾 |
| :set all    | 显示所有支持的配置项             |
| :set        | 显示你改动过的设置参数           |

3. 多文件编辑

| 操作   | 含义                            |
| ------ | ------------------------------- |
| :n     | 编辑上一个文件                  |
| :N     | 编辑下一个文件                  |
| :files | 列出目前这个 vim 打开的所有文件 |

4. 多窗口

| 操作                      | 含义                                                         |
| ------------------------- | ------------------------------------------------------------ |
| :sp [filename]            | 打开一个新窗口，如果加有 filename，则在新窗口显示，否则表示两个<br>窗口为同一个文件内容 |
| ctrl + w then j or 下箭头 | 光标移动到下方窗口，ctrl + w 后，松按键，再按 j              |
| ctrl + w then k or 上箭头 | 光标移动到上方窗口，ctrl + w 后，松按键，再按 k              |
| ctrl + w then q or 上箭头 | 退出                                                         |

5. 代码提示

| 操作                   | 含义                         |
| ---------------------- | ---------------------------- |
| ctrl + x then ctrl + n | 通过当前文件的内容给予提示   |
| ctrl + x then ctrl + o | 以扩展名为语法补充，给予提示 |



# 06. 常用配置项（环境参数）

| 参数                        | 含义                                                         |
| --------------------------- | ------------------------------------------------------------ |
| set nu\nonu                 | 是否显示行号                                                 |
| set hlsearch\nohlsearch     | 是否将搜索的字符串反白显示                                   |
| set autoindent\noautoindent | 自动缩排                                                     |
| set backup                  | 自动备份，备份名默认为 ./filename~                           |
| set ruler                   | 右下角是否显示状态                                           |
| set showmode                | 左下角是否显示状态                                           |
| set backspace=()            | 编辑模式是否允许删除字符，0、1=仅可删除刚刚输入的字符<br>2=可以删除任意值 |
| syntax on\off               | 语法高亮                                                     |
| bg=dart\light               | 色调                                                         |

